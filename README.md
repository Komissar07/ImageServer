## Финальный проект JavaRush по 2 модулю

# "Сервер картинок"
Cервис для просмотра и хранения изображений в виде веб-приложения. Пользователь заходит на сайт, загружает фотки или картинки, а взамен получает прямые ссылки на них.

**Запуск проекта:**  
`docker compose up --build -d`

**Остановка проекта и удаление томов:**  
`docker compose down -v`

**Доступ к сервису:**  
[http://localhost:8080](http://localhost:8080)

------

## Используемые технологии

- Python — backend для обработки запросов, загрузки изображений и логирования действий пользователей.
- Nginx — для быстрой раздачи загруженных изображений напрямую, минуя backend.
- PostgreSQL — хранение метаданных об изображениях в базе данных.
- Docker и Docker Compose — для запуска и управления всеми компонентами как единым целым.

## Структура проекта

**Директории и файлы:**
```text
project/
├── app.py                # Основной Python-бэкенд
├── db_manager.py         # Создание и управление запросами к БД
├── requirements.txt      # Зависимости Python
├── Dockerfile            # Dockerfile для Python-бэкенда
├── docker-compose.yml    # Конфигурация Docker Compose
├── nginx.conf            # Конфигурация Nginx
├── images/               # Папка для хранения загруженных изображений (volume)
├── logs/                 # Папка для логов (volume)
├── static/               # Дополнительные статические файлы (CSS/JS, если применимо)
└── backup/               # Папка для хранения резервных копий
```

**Описание ключевых компонентов:**
1. **app.py:**
- Реализует обработку HTTP-запросов:
    - `GET /` — главная страница.
    - `POST /upload` — загрузка изображения.
    - `POST /delete/id` — удаление изображения по id.
- Выполняет:
    - Валидацию загружаемого файла (формат, размер).
    - Сохранение файла в папку `/images`.
    - Сохранение метаданных изображения в БД.
    - Удаление изображения из папки `/images`.
    - Удаление метаданных изображения из БД.
    - Логирование действий в файл `app.log`.
  
2. **nginx.conf:**
- Раздает содержимое папки `/images` по маршруту `/images/<имя_файла>`.
- Проксирует запросы, не связанные со статикой, на Python-бэкенд.

3. **docker-compose.yml:**
- Определяет три сервиса:
    - `app` — Python-бэкенд.
    - `nginx` — Nginx-сервер.
    - `db` — БД PostgreSQL.
- Создает три тома:
    - `images` — для хранения загруженных изображений.
    - `logs` — для хранения логов.
    - `pg_data` — для хранения БД PostgreSQL.
  
4. **images/:**
- Каталог, в который сохраняются все загруженные файлы.
- Подключается как volume для долговременного хранения.

5. **logs/:**
- Каталог, содержащий лог-файлы (`app.log`).
- Подключается как volume для сохранности данных между перезапусками.

6. **pg_data/:**
- Каталог с файлами БД.
- Подключается как volume для сохранности данных между перезапусками.

7. **backup/:**
- Каталог, содержащий резервные копии БД.

------

## Резервное копирование и восстановление БД 
**Создание резервной копии:**
- docker exec -t postgres_17_5 pg_dump -U postgres images > ./backup/dump_$(date +%F_%H%M%S).sql

**Восстановление из резервной копии:**
- docker exec -i postgres_17_5 psql -U postgres -d images < dump.sql